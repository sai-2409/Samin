<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Мои Заказы - Samin</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/order_status.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/user_orders.css') }}"
    />
    <link
      rel="icon"
      type="image/svg+xml"
      href="{{ url_for('static', filename='images/logo__walnuts-print-version.svg') }}"
    />
  </head>
  <body {% if user %}data-user-login="{{ user.login }}" {% endif %}>
    <div class="orders-page">
      <div class="orders-header">
        <img
          src="{{ url_for('static', filename='images/logo__walnuts-print-version.svg') }}"
          alt="Logotype"
        />
        <h1>Мои Заказы</h1>
      </div>

      {% if orders %}
      <div class="orders-container">
        {% for order in orders %}
        <div class="order-card">
          <div class="order-header">
            <div>
              <h3 class="order-title">
                Заказ #{{ order.order_id[:8] if order.order_id else 'N/A' }}
              </h3>
              <p class="order-date">
                {% if order.timestamp %} {{ order.timestamp.split('T')[0] if 'T'
                in order.timestamp else order.timestamp }} {% else %} N/A {%
                endif %}
              </p>
            </div>
            <div
              class="order-status-badge {% if order.status == 'Оформлен' %}order-status-ordered{% elif order.status == 'Собран' %}order-status-collected{% elif order.status == 'Отправлен' %}order-status-shipped{% elif order.status == 'Доставлен' %}order-status-delivered{% else %}order-status-default{% endif %}"
            >
              {{ order.status if order.status else 'Оформлен' }}
            </div>
          </div>

          <div class="order-details">
            <div class="order-info-grid">
              <div class="order-info-item">
                <span class="order-info-label">Сумма:</span>
                <span class="order-info-value"
                  >₽{{ order.total if order.total else '0' }}</span
                >
              </div>
              <div class="order-info-item">
                <span class="order-info-label">Доставка:</span>
                <span class="order-info-value"
                  >{{ order.delivery_date if order.delivery_date else 'Не
                  выбрана' }}</span
                >
              </div>
            </div>

            {% if order.customer_info and order.customer_info.address %}
            <div class="order-address">
              <span class="order-info-label">Адрес:</span>
              <span class="order-info-value"
                >{{ order.customer_info.address }}</span
              >
            </div>
            {% endif %}
          </div>

          {% if order.cart_items %}
          <div class="order-items">
            <h4 class="order-items-title">Товары:</h4>
            <div class="order-items-list">
              {% for item in order.cart_items %}
              <div class="order-item">
                <span class="order-item-name">
                  {{ item.productName if item.productName else (item.name if
                  item.name else 'Товар') }} x{{ item.quantity if item.quantity
                  else 1 }}
                </span>
                <span class="order-item-price">
                  ₽{{ (item.price * item.quantity) if item.price and
                  item.quantity else (item.price if item.price else 0) }}
                </span>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <div class="order-actions">
            <a
              href="/order-tracking?order_id={{ order.order_id }}"
              class="track-order-btn"
            >
              Отследить заказ
            </a>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="empty-orders">
        <h3>У вас пока нет заказов</h3>
        <p>Сделайте свой первый заказ и он появится здесь</p>
        <a href="/" class="shop-now-btn"> Перейти к покупкам </a>
      </div>
      {% endif %}

      <div class="back-home">
        <a href="/" class="back-home-btn"> ← Вернуться на главную </a>
      </div>
    </div>
  </body>
</html>
