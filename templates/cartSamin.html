<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Connecting the Yandex Maps API Key -->
    <script
      src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey={{ config.YANDEX_MAPS_API_KEY }}"
      type="text/javascript"
    ></script>
    
    <!-- Fallback API key for JavaScript -->
    <script>
      // Ensure API key is available for JavaScript
      window.YANDEX_MAPS_API_KEY = "{{ config.YANDEX_MAPS_API_KEY }}";
    </script>

    <!-- Google fonts and icons-->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <!-- Better favicon support -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="{{ url_for('static', filename='images/logo__walnuts-print-version.svg') }}"
    />
    <link
      rel="icon"
      type="image/png"
      href="{{ url_for('static', filename='images/logo__walnuts-print-version.png') }}"
    />
    <link
      rel="apple-touch-icon"
      href="{{ url_for('static', filename='images/logo__walnuts-print-version.png') }}"
    />

    <!-- CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/responsiveCart.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/animation.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styleCartSamin.css') }}"
    />

    <!-- Notification System Styles -->
    <style>
      /* Floating Notification System */
      .floating-notifications {
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 1000;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .floating-notifications:hover {
        transform: scale(1.1);
      }

      .notification-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #ff6b6b, #ff5252);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        position: relative;
        transition: all 0.3s ease;
      }

      .notification-icon:hover {
        box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        transform: translateY(-2px);
      }

      .notification-icon svg {
        width: 24px;
        height: 24px;
        fill: white;
      }

      .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: linear-gradient(135deg, #ff9800, #ff5722);
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
        box-shadow: 0 2px 8px rgba(255, 152, 0, 0.4);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      .notification-panel {
        position: fixed;
        bottom: 90px;
        left: 20px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        width: 300px;
        max-height: 400px;
        overflow-y: auto;
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transform: translateY(20px);
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .notification-panel.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .notification-header {
        padding: 16px 20px;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .notification-header h3 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
        color: #333;
      }

      .notification-close {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        color: #666;
        padding: 4px;
        border-radius: 50%;
        transition: all 0.3s ease;
      }

      .notification-close:hover {
        background: #f0f0f0;
        color: #333;
      }

      .notification-list {
        max-height: 300px;
        overflow-y: auto;
      }

      .notification-item {
        padding: 12px 20px;
        border-bottom: 1px solid #f8f8f8;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .notification-item:hover {
        background: #f8f9fa;
      }

      .notification-item:last-child {
        border-bottom: none;
      }

      .notification-item.unread {
        background: #fff3cd;
        border-left: 4px solid #ff9800;
      }

      .notification-title {
        font-size: 14px;
        font-weight: 500;
        color: #333;
        margin-bottom: 4px;
      }

      .notification-message {
        font-size: 12px;
        color: #666;
        line-height: 1.4;
      }

      .notification-time {
        font-size: 11px;
        color: #999;
        margin-top: 4px;
      }

      .notification-empty {
        padding: 40px 20px;
        text-align: center;
        color: #666;
      }

      .notification-empty svg {
        width: 48px;
        height: 48px;
        fill: #ddd;
        margin-bottom: 12px;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .floating-notifications {
          bottom: 15px;
          left: 15px;
        }

        .notification-panel {
          width: 280px;
          left: 15px;
          bottom: 85px;
        }
      }
    </style>

    <!-- Coding for the header of the website -->
    <header class="header">
      <div class="header__container">
        <nav class="nav">
          <div class="header__logos">
            <img
              src="{{ url_for('static', filename='images/logoWalnuts-welcome-page.svg') }}"
              alt="SAMIN –ª–æ–≥–æ—Ç–∏–ø"
              class="header__logo"
            />
            <div class="logo__name">
              <h2 class="header__samin">SAMIN</h2>
              <p class="header__statement">
                –û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ. –ü–æ–±–∞–ª—É–π—Ç–µ. –ü—Ä–æ—Ü–≤–µ—Ç–∞–π—Ç–µ.
              </p>
            </div>
          </div>
          <!-- <nav class="nav__small-screens">
            {% if user %}
            <div class="header__profile header__profile-small-screens">
              <img
                src="https://avatars.yandex.net/get-yapic/{{ user.avatar }}/islands-retina-50"
                alt="avatar"
              />
              <span>{{ user.login }}</span>
              <div class="header__profile-dropdown">
                <a href="/reviews" class="header__profile-logout">–ú–æ–∏ –æ—Ç–∑—ã–≤—ã</a>
                <a href="/user_orders" class="header__profile-logout"
                  >–ú–æ–∏ –ó–∞–∫–∞–∑—ã</a
                >
                <a href="/logout" class="header__profile-logout">–í—ã–π—Ç–∏</a>
              </div>
            </div>
            {% else %}
            Yandex ID login removed -->
            <!-- {% endif %}
            <button id="toggleBtn">‚ò∞ –ú–µ–Ω—é</button>
          </nav> -->

          <!-- Overlay -->
          <div id="overlay" class="overlay"></div>

          <!-- Sidebar -->
          <!-- <div id="sidebar" class="sidebar">
            <button id="closeBtn" class="close-btn">‚úñ</button>
            <ul>
              <li>
                <a href="/"><span>üè°</span> –ì–ª–∞–≤–Ω–∞—è</a>
              </li>
              <li>
                <a href="#section__2"><span>üåü</span> –î–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞</a>
              </li>
              <li>
                <a href="#section__3"><span>ü•ú</span> –ú–µ–Ω—é</a>
              </li>
              <li>
                <a href="#section__4"><span>üí¨</span> –û—Ç–∑—ã–≤—ã</a>
              </li>
              <li>
                <a href="/cart"><span>üõí</span> –ö–æ—Ä–∑–∏–Ω–∞</a>
              </li>
            </ul>
          </div> -->
          <!-- <div class="header__list">
            <ul>
              <li class="header__list-item">
                <a href="/" class="nav__link nav__btn1">–ì–ª–∞–≤–Ω–∞—è</a>
              </li>
              <li class="header__list-item">
                <a href="#section__2" class="nav__link nav__btn2"
                  >–î–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞</a
                >
              </li>
              <li class="header__list-item">
                <a href="#section__3" class="nav__link nav__btn3">–ú–µ–Ω—é</a>
              </li>

              <li class="header__list-item">
                <a href="#section__4" class="nav__link nav__btn4">–û—Ç–∑—ã–≤—ã</a>
              </li>
              <li class="header__list-item">
                <a
                  href="/cart"
                  class="nav__link"
                  style="color: #4caf50; font-weight: bold"
                  >–ö–æ—Ä–∑–∏–Ω–∞</a
                >
              </li>
            </ul>
          </div> -->
          <!-- <div class="header__order">
            <img
              src="{{ url_for('static', filename='images/icons/cart__icon.svg') }}"
              alt="Cart"
              class="header__cart"
            /> -->
            <!-- Puting Yandex Market ID avatar -->
            {% if user %}
            <div class="header__profile">
              <img
                src="https://avatars.yandex.net/get-yapic/{{ user.avatar }}/islands-retina-50"
                alt="avatar"
              />
              <span>{{ user.login }}</span>
              <div class="header__profile-dropdown">
                <a href="/reviews" class="header__profile-logout">–ú–æ–∏ –æ—Ç–∑—ã–≤—ã</a>
                <a href="/user_orders" class="header__profile-logout"
                  >–ú–æ–∏ –ó–∞–∫–∞–∑—ã</a
                >
                <a href="/logout" class="header__profile-logout">–í—ã–π—Ç–∏</a>
              </div>
            </div>
            {% else %}
            <div id="yandex-oauth-cart" class="header__button-yandexID" style="display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; cursor: pointer; margin-right: 15px;">
              <img src="{{ url_for('static', filename='images/logos/yandex-market-svg-logo-white.svg') }}" width="30px" height="30px" alt="Yandex ID">
              <span>–í–æ–π—Ç–∏ c –Ø–Ω–¥–µ–∫—Å ID</span>
            </div>
            {% endif %}
            <!-- Puting Yandex Market ID avatar -->
            <!-- <button class="header__button common__button">–ó–∞–∫–∞–∑–∞—Ç—å</button> -->
          </div>
        </nav>
      </div>
    </header>

    <!-- Coding for the header of the website -->

    <!-- Title for the website -->
    <title>Samin</title>
  </head>
  <body {% if user %}data-user-login="{{ user.login }}" {% endif %}>
    <!-- I will put the main cart here for a moment --><!-- I will put the main cart here for a moment -->
    <div class="floating-cart home__page-back">
      <svg viewBox="0 0 24 24" class="home-icon" fill="currentColor">
        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
      </svg>
    </div>
    <!-- I will put the main cart here for a moment -->

    <!-- Floating Notification System -->
    <div class="floating-notifications" onclick="toggleNotificationPanel()">
      <div class="notification-icon">
        <svg viewBox="0 0 24 24">
          <path
            d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"
          />
        </svg>
        <div class="notification-badge" id="notification-count">0</div>
      </div>
    </div>

    <!-- Notification Panel -->
    <div class="notification-panel" id="notification-panel">
      <div class="notification-header">
        <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
        <button class="notification-close" onclick="toggleNotificationPanel()">
          ‚úï
        </button>
      </div>
      <div class="notification-list" id="notification-list">
        <!-- Notifications will be loaded here -->
      </div>
    </div>

    <!-- Start building -->

    <!-- Login Success Message -->
    {% if just_logged_in and user %}
    <div
      style="
        background: linear-gradient(135deg, #4caf50, #45a049);
        color: white;
        padding: 15px;
        text-align: center;
        margin: 20px auto;
        max-width: 600px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      "
    >
      <div
        style="
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 10px;
        "
      >
        <span style="font-size: 24px">‚úÖ</span>
        <div>
          <h3 style="margin: 0 0 5px 0; font-size: 18px">
            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.real_name or user.display_name or
            user.login }}!
          </h3>
          <p style="margin: 0; font-size: 14px; opacity: 0.9">
            –í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑.
          </p>
        </div>
      </div>
    </div>
    {% endif %}

    <section class="items">
      <div class="common__container">
        <div class="head">
          <!-- <img
            src="{{ url_for('static', filename='images/logoWalnuts-welcome-page.svg') }}"
            alt="Logotype"
          /> -->
          <h1 class="common__header head__header">–ö–æ—Ä–∑–∏–Ω–∞</h1>
          <!-- <img
            src="{{ url_for('static', filename='images/logoWalnuts-welcome-page.svg') }}"
            alt="Logotype"
          /> -->
        </div>
      </div>
    </section>

    <section class="cardCart">
      <div class="cardCart__container common__container">
        <div class="cart__wrapper">
          <div class="wall">
            <div class="wall__brand">
              <img
                class="brand__logo"
                src="{{ url_for('static', filename='images/logo__walnuts-print-version.svg') }}"
                alt="Logotype"
              />
              <p class="wall__name1">SAMIN</p>
            </div>
          </div>
          <div class="sticky__form-start-trigger" style="height: 1px"></div>
          <div class="order">
            <div class="order__input-div">
              <input class="order__input" type="text" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥" />
              <!-- <label for="name" class="order__input-floating">–ü—Ä–æ–º–æ–∫–æ–¥</label> -->
            </div>
            <div class="order__items">
              <p class="order__items-quantity">
                <span class="order__count"></span>—Ç–æ–≤–∞—Ä–∞
              </p>
              <p class="order__items-price">0 ‚ÇΩ</p>
            </div>
            <div class="order__discount">
              <p class="order__discount-text order__common-text">–°–∫–∏–¥–∫–∏</p>
              <p class="order__discount-amount">–ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏</p>
            </div>
            <div class="order__delivery">
              <p class="order__delivery-text order__common-text">
                –î–æ—Å—Ç–∞–≤–∫–∞ –∏ —Å–µ—Ä–≤–∏—Å—ã
              </p>
              <p class="order__delivery-amount order__common-text">
                –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏
              </p>
            </div>
            <div class="order__summary">
              <p class="order__summary-text">–ò—Ç–æ–≥–æ</p>
              <p class="order__summary-amount">0 ‚ÇΩ</p>
            </div>
            <button class="order__button common__button">
              –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é
            </button>
          </div>
        </div>
        <div
          class="cart-bottom-observer"
          style="height: 1px; margin-top: 50px"
        ></div>
      </div>
    </section>
    <!-- Adding cards for the cart section -->

    <!-- Coding choosing address for the cart page -->
    <section class="address">
      <h1 class="common__header checkout__header-h1">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>
      <div class="yamap__container">
        <div class="yamap__left">
          <div class="address__form-form-container">
            <h2 class="address-form__title">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h2>
            <form class="address-form__form">
              <div class="address-form__group">
                <label for="fullName" class="address-form__label"
                  >–ü–æ–ª–Ω–æ–µ –∏–º—è</label
                >
                <input
                  type="text"
                  id="fullName"
                  name="fullName"
                  class="address-form__input"
                  placeholder="–ü–∞–≤–µ–ª –î—É—Ä–æ–≤"
                  required
                />
              </div>
              <div class="address-form__group">
                <label for="phone" class="address-form__label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  class="address-form__input"
                  placeholder="+7 (999) 999-99-99"
                  required
                />
              </div>
              <div class="address-form__group">
                <label for="yamap-address" class="address-form__label"
                  >–ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞</label
                >
                <input
                  type="text"
                  id="yamap-address"
                  class="address-form__input"
                  placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å"
                />
              </div>
              <div class="address-form__group">
                <label for="streetAddress" class="address-form__label"
                  >–£–ª–∏—Ü–∞</label
                >
                <input
                  type="text"
                  id="streetAddress"
                  name="streetAddress"
                  class="address-form__input"
                  placeholder="–ë–µ–≤–µ—Ä–ª–∏ –•–∏–ª–∑"
                  required
                />
              </div>
              <div class="address-form__group address-form__group-flex">
                <input
                  type="text"
                  id="building"
                  name="building"
                  class="address-form__input"
                  placeholder="–î–æ–º"
                  required
                />
                <input
                  type="text"
                  id="flat"
                  name="flat"
                  class="address-form__input"
                  placeholder="–ö–≤–∞—Ä—Ç–∏—Ä–∞"
                  required
                />
              </div>

              <div class="address-form__group">
                <label for="city" class="address-form__label">–ì–æ—Ä–æ–¥</label>
                <input
                  type="text"
                  id="city"
                  name="city"
                  class="address-form__input"
                  placeholder="–ú—É—Ö–æ—Å—Ä–∞–Ω—Å–∫"
                  required
                />
              </div>

              <div class="address-form__group">
                <label for="zipCode" class="address-form__label"
                  >ZIP Code</label
                >
                <input
                  type="text"
                  id="zipCode"
                  name="zipCode"
                  class="address-form__input"
                  placeholder="90001"
                  required
                />
              </div>

              <div class="address-form__buttons">
                <button
                  type="submit"
                  class="address-form__button-save commont__button"
                >
                  –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–¥—Ä–µ—Å
                </button>
                <button type="button" class="address-form__button-select">
                  –î–æ—Å—Ç–∞–≤–∏—Ç—å —Å—é–¥–∞
                </button>
              </div>
            </form>
          </div>
          <div
            class="common__container-saved-address"
            id="savedAddressList"
          ></div>
        </div>
        <div class="yamap__right">
          <div id="yamap" class="yamap__map"></div>
          <!-- <div
            class="common__container-saved-address"
            id="savedAddressList"
          ></div> -->
        </div>
      </div>
    </section>
    <!-- Coding choosing address for the cart page -->

    <section class="payment">
      <div class="payment__container">
        <div class="payment__delivery-methods">
          <div
            class="payment__delivery-method payment__delivery-method--active"
          >
            <div class="payment__delivery-title">–ö—É—Ä—å–µ—Ä Samin</div>
            <div class="payment__delivery-desc">–ó–∞–≤—Ç—Ä–∞ –∏–ª–∏ –ø–æ–∑–∂–µ</div>
            <div class="payment__delivery-free" id="payment-delivery-cost">
              99‚ÇΩ
            </div>
            <div class="payment__delivery-check"><span>‚úî</span></div>
          </div>
        </div>
        <div class="payment__date-block">
          <div class="payment__date-title">
            –ó–∞–≤—Ç—Ä–∞, –∫—É—Ä—å–µ—Ä–æ–º –ø–æ –∫–ª–∏–∫—É
            <span class="payment__date-info">–ö—É—Ä—å–µ—Ä Samin</span>
          </div>
          <div class="payment__date-options">
            <button class="payment__date-btn payment__date-btn--active">
              –°–µ–≥–æ–¥–Ω—è<br /><span>0‚ÇΩ</span>
            </button>
            <button class="payment__date-btn">
              –ó–∞–≤—Ç—Ä–∞<br /><span>0‚ÇΩ</span>
            </button>
            <button class="payment__date-btn">
              –ü–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞<br /><span>0‚ÇΩ</span>
            </button>
            <button class="payment__date-btn">
              —Å–±, 05.07<br /><span>0‚ÇΩ</span>
            </button>
            <button class="payment__date-btn">
              –≤—Å, 06.07<br /><span>0‚ÇΩ</span>
            </button>
            <button class="payment__date-btn">
              –ø–Ω, 07.07<br /><span>0‚ÇΩ</span>
            </button>
          </div>
        </div>
        <div class="payment__address-row">
          <div class="payment__address-info">
            <span class="payment__address-label">–ê–¥—Ä–µ—Å:</span>
            <span class="payment__address-value" id="payment-address-value"
              >‚Äî</span
            >
          </div>
          <div class="payment__recipient-info">
            <span class="payment__recipient-label">–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</span>
            <span class="payment__recipient-value" id="payment-recipient-value"
              >‚Äî</span
            >
            <span
              class="payment__recipient-phone"
              id="payment-recipient-phone"
            ></span>
          </div>
        </div>
        <div class="payment__toggles">
          <label class="payment__toggle">
            <input type="checkbox" />
            <span class="payment__toggle-slider"></span>
            –û—Å—Ç–∞–≤–∏—Ç—å —É –¥–≤–µ—Ä–∏
          </label>
          <label class="payment__toggle">
            <input type="checkbox" />
            <span class="payment__toggle-slider"></span>
            –ü–µ—Ä–µ–¥–∞—Ç—å –Ω–∞ —Ä—É–∫–∏
          </label>
          <label class="payment__toggle">
            <input type="checkbox" />
            <span class="payment__toggle-slider"></span>
            –ù–µ –∑–≤–æ–Ω–∏—Ç—å
          </label>
        </div>
        <div class="payment__products-row" id="payment-products-row">
          <!-- JS will render cart items here -->
          <span
            class="payment__products-total"
            id="payment-products-total"
          ></span>
        </div>
      </div>
      <div class="payment__summary">
        <div class="payment__summary-header">
          <!-- <div class="payment__summary-cards">
              <div
                id="payment-added-cards"
                style="display: flex; gap: 8px"
              ></div>
              <button
                class="payment__summary-card payment__add-card-btn"
                id="add-card-btn"
              >
                <span
                  style="
                    font-size: 1.3em;
                    margin-right: 8px;
                    vertical-align: middle;
                  "
                  >Ôºã</span
                >–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É
              </button>
            </div> -->
          <!-- <div class="payment__summary-info">
              <div>1398‚ÇΩ</div>
            </div> -->
        </div>
        <div
          class="payment__summary-products-row"
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #222;
          "
        >
          <span id="payment-summary-products-count">2 —Ç–æ–≤–∞—Ä–∞</span>
          <span id="payment-summary-products-total">1398‚ÇΩ</span>
        </div>
        <div class="payment__summary-row">
          <span>–í—ã–≥–æ–¥–∞</span>
          <span class="payment__summary-discount">-500‚ÇΩ</span>
        </div>
        <div class="payment__summary-row">
          <span>–î–æ—Å—Ç–∞–≤–∫–∞ –∏ —Å–µ—Ä–≤–∏—Å—ã</span>
          <span id="payment-summary-delivery-cost">0‚ÇΩ</span>
        </div>
        <div class="payment__summary-row">
          <span>–ü—Ä–æ–º–æ–∫–æ–¥</span>
          <div class="payment-summary-delivery-cost">–±–µ–∑ –ø—Ä–æ–º–æ–∫–æ–¥–∞</div>
        </div>
        <div class="payment__summary-row payment__summary-row--total">
          <span>–û–ø–ª–∞—Ç–∞ –æ–Ω–ª–∞–π–Ω</span>
          <span class="payment__summary-total">657‚ÇΩ</span>
        </div>

        <div id="yandex-pay-button-container" style="display: none"></div>
        <div id="yandex-pay-button"></div>

        <div class="payment__secure">–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ <br />—Å –Ø–Ω–¥–µ–∫—Å Pay</div>
      </div>
    </section>
    <!-- Coding for the footer of the website  -->
    <footer class="footer">
      <div class="footer__container common__container">
        <img
          src="{{ url_for('static', filename='images/logoWalnuts-welcome-page.svg') }}"
          alt="Logotype"
          class="footer__logo"
        />
        <div class="footer__others">
          <h2 class="footer__mini-header">–î—Ä—É–≥–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</h2>
          <ul>
            <li>
              <a class="footer__links" href="" class="other__platforms-links"
                >–Ø–Ω–¥–µ–∫—Å –ú–∞—Ä–∫–µ—Ç</a
              >
            </li>
            <li>
              <a class="footer__links" href="" class="other__platforms-links"
                >–í–∞–π–ª–¥–±–µ—Ä—Ä–∏–∑</a
              >
            </li>
            <li>
              <a class="footer__links" href="" class="other__platforms-links"
                >–û–∑–æ–Ω</a
              >
            </li>
            <li>
              <a class="footer__links" href="" class="other__platforms-links"
                >–ú–µ–≥–∞–º–∞—Ä–∫–µ—Ç</a
              >
            </li>
          </ul>
        </div>
        <div class="footer__others">
          <h2 class="footer__mini-header">–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏</h2>
          <ul>
            <li><a class="footer__links" href="#!">–ò–Ω—Å—Ç–∞–≥—Ä–∞–º–º</a></li>
            <li><a class="footer__links" href="#!">–í –∫–æ–Ω—Ç–∞–∫—Ç–µ</a></li>
            <li><a class="footer__links" href="#!">Facebook</a></li>
          </ul>
        </div>
        <div class="footer__others footer__company">
          <h2 class="footer__mini-header">–û –∫–æ–º–ø–∞–Ω–∏–∏</h2>
          <button class="footer__dropdown-btn" onclick="toggleCompanyInfo()">
            –Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ
          </button>
          <div id="company-info" class="footer__dropdown-content">
            –ò–ü –°–∞–º–∏–¥–∂–æ–Ω–æ–≤ –°—É—Ö—Ä–æ–± <br />
            –ò–ù–ù: 561018294789 <br />
            –ê–¥—Ä–µ—Å: –ö–∞–ª—É–∂—Å–∫–æ–µ —à–æ—Å—Å–µ 10, –ú–∞–º—ã—Ä–∏, –ú–æ—Å–∫–≤–∞, 129090<br />
            –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 341-21-51 <br />
            Email: samin2409@mail.ru <br />
          </div>
        </div>
        <div class="footer__map">
          <h2 class="footer__mini-header">–ù–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h2>
          <div class="map-container">
            <iframe
              src="https://maps.google.com/maps?q=55.601000,37.471100&z=15&output=embed"
              width="100%"
              height="250"
              style="border: 0"
              allowfullscreen
              loading="lazy"
            ></iframe>
          </div>
        </div>
      </div>
    </footer>
    <footer class="last__footer">
      <div class="last__footer-content">¬© 2023 Samin. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</div>
    </footer>
    <!-- Coding for the footer of the website  -->

    <!-- Writing html structure for the payment modal -->

    <!-- Address Selection Modal -->
    <div id="address-modal" class="address-modal" style="display: none">
      <div class="address-modal__overlay"></div>
      <div class="address-modal__content">
        <div class="address-modal__header">
          <h3 class="address-modal__title">–í—ã–±–µ—Ä–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
          <button class="address-modal__close" onclick="hideAddressModal()">
            √ó
          </button>
        </div>
        <div class="address-modal__body">
          <p class="address-modal__message">
            –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ —á—Ç–æ–±—ã –º—ã —Å–º–æ–≥–ª–∏ –ø—Ä–∏–≤–µ–∑—Ç–∏ –≤–∞—à–∏
            –æ—Ä–µ—à–∫–∏
          </p>
        </div>
        <div class="address-modal__footer">
          <button class="address-modal__btn" onclick="hideAddressModal()">
            –ü–æ–Ω—è—Ç–Ω–æ
          </button>
        </div>
      </div>
    </div>
    <!-- Address Selection Modal -->

    <!-- Login Modal -->
    <div id="login-modal" class="login-modal" style="display: none">
      <div class="login-modal__overlay"></div>
      <div class="login-modal__content">
        <div class="login-modal__header">
          <h3 class="login-modal__title">–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</h3>
          <button class="login-modal__close" onclick="hideLoginModal()">
            √ó
          </button>
        </div>
        <div class="login-modal__body">
          <div class="login-modal__logo">
            <img
              src="{{ url_for('static', filename='images/logoWalnuts-welcome-page.svg') }}"
              alt="Samin Logo"
              class="login-modal__logo-img"
            />
          </div>
          <p class="login-modal__message">
            –î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
          </p>
          <div class="login-modal__benefits">
            <div class="login-modal__benefit">
              <span class="login-modal__benefit-icon">üì¶</span>
              <span>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤</span>
            </div>
            <div class="login-modal__benefit">
              <span class="login-modal__benefit-icon">üí≥</span>
              <span>–ë—ã—Å—Ç—Ä–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</span>
            </div>
            <div class="login-modal__benefit">
              <span class="login-modal__benefit-icon">üéÅ</span>
              <span>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–∫–∏–¥–∫–∏</span>
            </div>
          </div>
        </div>
        <div class="login-modal__footer">
          <a href="/login" class="login-modal__btn">
            <span class="login-modal__yandex-icon">üë§</span>
            –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å ID
          </a>
        </div>
      </div>
    </div>
    <!-- Login Modal -->

    <!-- Card Add Modal -->
    <div id="add-card-modal" class="add-card-modal" style="display: none">
      <div class="add-card-modal__overlay"></div>
      <div class="add-card-modal__content">
        <button class="add-card-modal__close" id="add-card-modal-close">
          √ó
        </button>
        <h2 class="add-card-modal__title">–î–æ–±–∞–≤—å—Ç–µ –∫–∞—Ä—Ç—É –ª—é–±–æ–≥–æ –±–∞–Ω–∫–∞</h2>
        <form id="add-card-form" class="add-card-modal__form">
          <input
            type="text"
            id="card-number"
            maxlength="19"
            placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã"
            required
          />
          <div class="add-card-modal__row">
            <input
              type="text"
              id="card-expiry"
              maxlength="5"
              placeholder="–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ"
              required
            />
            <input
              type="text"
              id="card-cvv"
              maxlength="4"
              placeholder="–ö–æ–¥"
              required
            />
          </div>
          <button
            type="submit"
            id="add-card-submit"
            class="add-card-modal__submit"
            disabled
          >
            –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É
          </button>
        </form>
        <div class="add-card-modal__note">
          –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ø–∏—à–µ–º –∏ –≤–µ—Ä–Ω—ë–º –Ω–µ–±–æ–ª—å—à—É—é —Å—É–º–º—É
        </div>
      </div>
    </div>

    <!-- Success Payment Modal -->
    <div class="modal-success" style="display: none">
      <div class="modal-content">
        <div class="modal-title">–ú—ã –ø–æ–ª—É—á–∏–ª–∏ –≤–∞—à –∑–∞–∫–∞–∑</div>
        <div class="success-icon">
          <svg viewBox="0 0 80 80" fill="none">
            <circle
              cx="40"
              cy="40"
              r="38"
              stroke="#1dbf73"
              stroke-width="4"
              fill="#eafff3"
            />
            <path
              class="success-check"
              d="M24 42 L36 54 L56 30"
              stroke="#1dbf73"
              stroke-width="5"
              stroke-linecap="round"
              stroke-linejoin="round"
              fill="none"
            />
          </svg>
        </div>
        <div class="modal-btn">–£—Ä–∞–∞–∞–∞–∞!</div>
      </div>
    </div>
    <!-- Success Payment Modal -->

    <!-- Connecting JS to the HTML -->

    <!-- Connecting Yandex Market vidget and API for payment -->
    <script src="https://pay.yandex.ru/sdk/v1/pay.js"></script>

    <!-- Connecting GSAP to my html -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- Connecting the Yandex Maps API Key -->
    <script
      src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey={{ config.YANDEX_MAPS_API_KEY }}"
      type="text/javascript"
    ></script>
    <!-- my scripts -->
    <script src="{{ url_for('static', filename='js/yandexPayInit.js') }}"></script>
    <script src="{{ url_for('static', filename='js/animationGSAP.js') }}"></script>
    <script src="{{ url_for('static', filename='js/commonScript.js') }}"></script>
    <script src="{{ url_for('static', filename='js/saminCartScript.js') }}"></script>

    <!-- <script>
      ymaps.ready(() => {
        if (typeof initYandexMap === "function") {
          initYandexMap();
        } else {
          console.error("initYandexMap is not defined");
        }
      });
    </script> -->

    <!-- Notification System JavaScript -->
    <script>
      let notificationPanelVisible = false;
      let notifications = [];

      // Toggle notification panel
      function toggleNotificationPanel() {
        const panel = document.getElementById("notification-panel");
        notificationPanelVisible = !notificationPanelVisible;

        if (notificationPanelVisible) {
          panel.classList.add("show");
          loadNotifications();
        } else {
          panel.classList.remove("show");
        }
      }

      // Load notifications from server
      function loadNotifications() {
        const user = document.querySelector("[data-user-login]");
        if (!user) {
          showEmptyNotifications();
          return;
        }

        fetch("/api/get-notifications")
          .then((response) => response.json())
          .then((data) => {
            notifications = data.notifications || [];
            updateNotificationBadge();
            displayNotifications();
          })
          .catch((error) => {
            console.error("Error loading notifications:", error);
            showEmptyNotifications();
          });
      }

      // Update notification badge count
      function updateNotificationBadge() {
        const badge = document.getElementById("notification-count");
        const unreadCount = notifications.filter((n) => !n.read).length;
        badge.textContent = unreadCount;

        if (unreadCount > 0) {
          badge.style.display = "flex";
        } else {
          badge.style.display = "none";
        }
      }

      // Display notifications in panel
      function displayNotifications() {
        const list = document.getElementById("notification-list");

        if (notifications.length === 0) {
          showEmptyNotifications();
          return;
        }

        list.innerHTML = notifications
          .map(
            (notification) => `
                <div class="notification-item ${
                  notification.read ? "" : "unread"
                }" 
                     onclick="markNotificationRead('${notification.id}')">
                    <div class="notification-title">${notification.title}</div>
                    <div class="notification-message">${
                      notification.message
                    }</div>
                    <div class="notification-time">${formatNotificationTime(
                      notification.timestamp
                    )}</div>
                </div>
            `
          )
          .join("");
      }

      // Show empty state
      function showEmptyNotifications() {
        const list = document.getElementById("notification-list");
        list.innerHTML = `
                <div class="notification-empty">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
                    </svg>
                    <p>–ù–µ—Ç –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>
                </div>
            `;
      }

      // Mark notification as read
      function markNotificationRead(notificationId) {
        fetch("/api/mark-notification-read", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            notification_id: notificationId,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              // Update local notifications
              notifications = notifications.map((n) =>
                n.id === notificationId ? { ...n, read: true } : n
              );
              updateNotificationBadge();
              displayNotifications();
            }
          })
          .catch((error) => {
            console.error("Error marking notification as read:", error);
          });
      }

      // Format notification time
      function formatNotificationTime(timestamp) {
        const date = new Date(timestamp);
        const now = new Date();
        const diff = now - date;

        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);

        if (minutes < 1) return "–¢–æ–ª—å–∫–æ —á—Ç–æ";
        if (minutes < 60) return `${minutes} –º–∏–Ω –Ω–∞–∑–∞–¥`;
        if (hours < 24) return `${hours} —á –Ω–∞–∑–∞–¥`;
        if (days < 7) return `${days} –¥–Ω –Ω–∞–∑–∞–¥`;

        return date.toLocaleDateString("ru-RU");
      }

      // Close panel when clicking outside
      document.addEventListener("click", function (event) {
        const panel = document.getElementById("notification-panel");
        const notificationIcon = document.querySelector(
          ".floating-notifications"
        );

        if (
          !panel.contains(event.target) &&
          !notificationIcon.contains(event.target)
        ) {
          panel.classList.remove("show");
          notificationPanelVisible = false;
        }
      });

      // Initialize notifications on page load
      document.addEventListener("DOMContentLoaded", function () {
        loadNotifications();

        // Check for new notifications every 30 seconds
        setInterval(loadNotifications, 30000);
      });

      // Yandex OAuth Login Function
      function loginWithYandex() {
        const statusDiv = document.createElement("div");
        statusDiv.id = "status";
        statusDiv.className = "status info";
        statusDiv.textContent = "–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Yandex –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...";
        statusDiv.style.cssText = "position: fixed; top: 20px; right: 20px; background: #4CAF50; color: white; padding: 15px; border-radius: 8px; z-index: 10000; box-shadow: 0 4px 8px rgba(0,0,0,0.2);";
        document.body.appendChild(statusDiv);

        // Get configuration from Flask backend
        fetch("/api/config")
          .then((response) => response.json())
          .then((config) => {
            // Construct the OAuth authorization URL
            const clientId = config.client_id;
            const redirectUri = encodeURIComponent(config.redirect_uri);
            const responseType = "code";
            const scope = config.scopes.join(" ");
            const authUrl = `https://oauth.yandex.ru/authorize?client_id=${clientId}&response_type=${responseType}&redirect_uri=${redirectUri}&scope=${scope}`;

            // Redirect to Yandex OAuth
            window.location.href = authUrl;
          })
          .catch((error) => {
            statusDiv.className = "status error";
            statusDiv.textContent = "–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: " + error.message;
            console.error("Config error:", error);
            
            // Remove status after 5 seconds
            setTimeout(() => {
              if (statusDiv.parentNode) {
                statusDiv.parentNode.removeChild(statusDiv);
              }
            }, 5000);
          });
      }

      // Add click event listener to Yandex login button
      document.addEventListener("DOMContentLoaded", function () {
        const loginButton = document.getElementById("yandex-oauth-cart");
        if (loginButton) {
          loginButton.addEventListener("click", loginWithYandex);
        }
      });
    </script>
  </body>
</html>
